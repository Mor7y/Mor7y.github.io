<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>服务容器 - Morty's Blog</title><meta name=Description content="关于 LoveIt 主题"><meta property="og:title" content="服务容器"><meta property="og:description" content="服务容器 简介 Laravel 服务容器是一个用于管理类依赖以及实现依赖注入的强有力工具。依赖注入这个名词表面看起来花哨，实质上是指：通过构造函数，或者某些情"><meta property="og:type" content="article"><meta property="og:url" content="https://v2wy.com/demo/"><meta property="og:image" content="https://v2wy.com/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-22T19:55:18+08:00"><meta property="article:modified_time" content="2021-09-27T14:33:00+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://v2wy.com/logo.png"><meta name=twitter:title content="服务容器"><meta name=twitter:description content="服务容器 简介 Laravel 服务容器是一个用于管理类依赖以及实现依赖注入的强有力工具。依赖注入这个名词表面看起来花哨，实质上是指：通过构造函数，或者某些情"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://v2wy.com/demo/><link rel=next href=https://v2wy.com/emoji-support/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"服务容器","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/v2wy.com\/demo\/"},"image":[{"@type":"ImageObject","url":"https:\/\/v2wy.com\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"posts","wordcount":6745,"url":"https:\/\/v2wy.com\/demo\/","datePublished":"2021-03-22T19:55:18+08:00","dateModified":"2021-09-27T14:33:00+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Morty","logo":{"@type":"ImageObject","url":"https:\/\/v2wy.com\/images\/avatar.png","width":528,"height":560}},"author":{"@type":"Person","name":"Morty"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'light'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'light'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Morty's Blog"><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>Morty's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/categories/documentation/>文档 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/v2wy title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/demo/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Morty's Blog"><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>Morty's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/categories/documentation/ title>文档</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/v2wy title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value"><option value=/demo/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">服务容器</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Morty</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-03-22>2021-03-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 6745 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 14 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#简介>简介</a><ul><li><a href=#零配置解决方案>零配置解决方案</a></li><li><a href=#何时使用容器>何时使用容器</a></li></ul></li><li><a href=#绑定>绑定</a><ul><li><a href=#基础绑定>基础绑定</a></li><li><a href=#简单绑定>简单绑定</a></li><li><a href=#单例的绑定>单例的绑定</a></li><li><a href=#绑定实例>绑定实例</a></li><li><a href=#绑定接口至实现>绑定接口至实现</a></li><li><a href=#上下文绑定>上下文绑定</a></li><li><a href=#绑定基本值>绑定基本值</a></li><li><a href=#绑定变长参数类型>绑定变长参数类型</a></li><li><a href=#变长参数的关联标签>变长参数的关联标签</a></li><li><a href=#标签>标签</a></li><li><a href=#继承绑定>继承绑定</a></li></ul></li><li><a href=#解析>解析</a><ul><li><a href=#make-方法><code>make</code> 方法</a></li><li><a href=#自动注入>自动注入</a></li></ul></li><li><a href=#容器事件>容器事件</a></li><li><a href=#psr-11>PSR-11</a></li></ul></nav></div></div><div class=content id=content><h1 id=服务容器>服务容器</h1><h2 id=简介>简介</h2><p>Laravel 服务容器是一个用于管理类依赖以及实现依赖注入的强有力工具。依赖注入这个名词表面看起来花哨，实质上是指：通过构造函数，或者某些情况下通过「setter」方法将类依赖「注入」到类中。</p><p>我们来看一个简单的例子:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>namespace</span> <span class=nx>App\Http\Controllers</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>App\Http\Controllers\Controller</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Repositories\UserRepository</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Models\User</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * user 仓储的实现
</span><span class=sd>     *
</span><span class=sd>     * @var UserRepository
</span><span class=sd>     */</span>
    <span class=k>protected</span> <span class=nv>$users</span><span class=p>;</span>

    <span class=sd>/**
</span><span class=sd>     * 创建一个新的控制器实例
</span><span class=sd>     *
</span><span class=sd>     * @param  UserRepository  $users
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>UserRepository</span> <span class=nv>$users</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>users</span> <span class=o>=</span> <span class=nv>$users</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=sd>/**
</span><span class=sd>     * 展示给定用户的信息
</span><span class=sd>     *
</span><span class=sd>     * @param  int  $id
</span><span class=sd>     * @return Response
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nv>$id</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>users</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=nv>$id</span><span class=p>);</span>

        <span class=k>return</span> <span class=nx>view</span><span class=p>(</span><span class=s1>&#39;user.profile&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;user&#39;</span> <span class=o>=&gt;</span> <span class=nv>$user</span><span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>在这个例子中，<code>UserController</code> 控制器需要从数据源中获取 <code>users</code>。所以，我们可以注入一个能够获取 users 的服务。在这种情况下，我们的存储仓库 <code>UserRepository</code> 极有可能使用 Eloquent 从数据库中获取用户信息。然而，因为仓储是通过 UserRepository 注入的，我们可以很轻易的将其切换为另一个实现。 另外，这种方式的便利之处也体现在：当需要为应用编写测试的时候，我们也可以很轻松地 “模拟” 或者创建一个 <code>UserRepository</code> 存储层的伪实现来操作。</p><p>深入理解服务容器，对于构建一个强大的、大型的应用，以及对 Laravel 核心本身的贡献都是至关重要的。</p><h3 id=零配置解决方案>零配置解决方案</h3><p>如果一个类没有依赖项或只依赖于其他具体类 (而不是接口），则不需要指定容器如何解析该类。例如，您可以将以下代码放在 <code>routes/web.php</code> 文件中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>class</span> <span class=nc>Service</span>
<span class=p>{</span>
    <span class=c1>//
</span><span class=c1></span><span class=p>}</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Service</span> <span class=nv>$service</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>die</span><span class=p>(</span><span class=nx>get_class</span><span class=p>(</span><span class=nv>$service</span><span class=p>));</span>
<span class=p>});</span>
</code></pre></td></tr></table></div></div><p>在本例中，点击应用程序的 <code>/</code> 路由将自动解析 <code>Service</code> 类并将其注入路由的处理程序。这是一个有趣的改变。这意味着您可以开发应用程序并利用依赖注入，而不用再去关心臃肿的配置。</p><p>很荣幸的通知你，在构建 Laravel 应用程序时，您将要编写的许多类都可以通过容器自动接收它们的依赖关系，包括 <a href=https://learnku.com/docs/laravel/8.x/controllers target=_blank rel="noopener noreffer">控制器</a>，<a href=https://learnku.com/docs/laravel/8.x/events target=_blank rel="noopener noreffer">事件</a>，<a href=https://learnku.com/docs/laravel/8.x/middleware target=_blank rel="noopener noreffer">中间件</a> 。此外，您可以在 <a href=https://learnku.com/docs/laravel/8.x/queues target=_blank rel="noopener noreffer">队列</a> 的 <code>handle</code> 方法中键入提示依赖项。一旦你尝到了零配置依赖注入的威力，你就会觉得没有它是不可以开发的。</p><h3 id=何时使用容器>何时使用容器</h3><p>得益于零配置解决方案，通常情况下，你只需要在路由、控制器、事件侦听器和其他地方键入提示依赖项，而不必手动与容器打交道。例如，可以在路由定义中键入 <code>Illuminate\Http\Request</code> 对象，以便轻松访问当前请求的 Request 类。尽管我们不必与容器交互来编写此代码，但它在幕后管理着这些依赖项的注入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// ...
</span><span class=c1></span><span class=p>});</span>
</code></pre></td></tr></table></div></div><p>在许多情况下，由于自动依赖注入和 <a href=https://learnku.com/docs/laravel/8.x/facades target=_blank rel="noopener noreffer">facades</a>，你在构建 laravel 应用程序的时候无需 <strong>手动</strong> 绑定或解析容器中的任何内容。<strong>那么，你将在什么时候手动与容器打交道呢</strong>？让我们来看看下面两种情况。</p><p>首先，如果要编写一个实现接口的类，并希望在路由或类的构造函数上键入该接口的提示，则必须 <a href=about:blank#binding-interfaces-to-implementations rel>告诉容器如何解析该接口</a>。第二，如果您正在 <a href=https://learnku.com/docs/laravel/8.x/packages target=_blank rel="noopener noreffer">编写一个 Laravel 包</a> 计划与其他 Laravel 开发人员共享，那么您可能需要将包的服务绑定到容器中。</p><h2 id=绑定>绑定</h2><h3 id=基础绑定>基础绑定</h3><h3 id=简单绑定>简单绑定</h3><p>几乎所有的服务容器绑定都会在 <a href=https://learnku.com/docs/laravel/8.x/providers target=_blank rel="noopener noreffer">服务提供者</a> 中注册，下面示例中的大多数将演示如何在该上下文（服务提供者）中使用容器。</p><p>在服务提供者中，你总是可以通过 <code>$this->app</code> 属性访问容器。我们可以通过容器的 <code>bind</code> 方法注册绑定，<code>bind</code> 方法的第一个参数为要绑定的类或接口名，第二个参数是一个返回类实例的闭包：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Services\PodcastParser</span><span class=p>;</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>bind</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=nx>Transistor</span><span class=p>(</span><span class=nv>$app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>PodcastParser</span><span class=o>::</span><span class=na>class</span><span class=p>));</span>
<span class=p>});</span>
</code></pre></td></tr></table></div></div><p>我们可以看下bind()方法的源代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>bind</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$concrete</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span> <span class=nv>$shared</span> <span class=o>=</span> <span class=k>false</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//删除旧的绑定
</span><span class=c1></span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>dropStaleInstances</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=c1>//如果没有给出实现类 那么实现类就是抽象
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>))</span> <span class=p>{</span>
        <span class=nv>$concrete</span> <span class=o>=</span> <span class=nv>$abstract</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>//如果$concrete不是闭包, 要把$concrete转换成闭包
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nv>$concrete</span> <span class=nx>instanceof</span> <span class=nx>Closure</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nx>is_string</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=nx>TypeError</span><span class=p>(</span><span class=nx>self</span><span class=o>::</span><span class=na>class</span><span class=o>.</span><span class=s1>&#39;::bind(): Argument #2 ($concrete) must be of type Closure|string|null&#39;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=nv>$concrete</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getClosure</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$concrete</span><span class=p>);</span>
    <span class=p>}</span>
		<span class=c1>//保存到$this-&gt;bindings数组
</span><span class=c1></span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bindings</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]</span> <span class=o>=</span> <span class=nx>compact</span><span class=p>(</span><span class=s1>&#39;concrete&#39;</span><span class=p>,</span> <span class=s1>&#39;shared&#39;</span><span class=p>);</span>
    <span class=c1>//如果已经实例化过, 要调用一下实例化的回调
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolved</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>))</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>rebound</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>bind方法的核心就是把抽象和实现的对应关系保存到bindings数组里面, 为了保持统一, 所有的实现类都被转换成了闭包.</p><p>注意，我们接受容器本身作为解析器的参数。然后，我们可以使用容器来解析正在构建的对象的子依赖。</p><h3 id=单例的绑定>单例的绑定</h3><p><code>singleton</code> 方法将类或接口绑定到只应解析一次的容器中。解析单例绑定后，后续调用容器时将返回相同的对象实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Services\PodcastParser</span><span class=p>;</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>singleton</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=nx>Transistor</span><span class=p>(</span><span class=nv>$app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>PodcastParser</span><span class=o>::</span><span class=na>class</span><span class=p>));</span>
<span class=p>});</span>
</code></pre></td></tr></table></div></div><p>我们可以看下singleton()方法是怎么实现的:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>singleton</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$concrete</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bind</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$concrete</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>直接调用的bind()方法, $shared参数传true, 表示这个绑定是共享的, 也就是单例.</p><h3 id=绑定实例>绑定实例</h3><p>还可以使用 <code>instance</code> 方法将现有对象实例绑定到容器中。给定实例将始终在随后调用容器时返回：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Services\PodcastParser</span><span class=p>;</span>

<span class=nv>$service</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Transistor</span><span class=p>(</span><span class=k>new</span> <span class=nx>PodcastParser</span><span class=p>);</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>instance</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$service</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><p>我们来看就源码:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>instance</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$instance</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//从上下文绑定别名缓存中删除别名。
</span><span class=c1></span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>removeAbstractAlias</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
		<span class=c1>//确定给定的抽象类型是否已绑定。
</span><span class=c1></span>    <span class=nv>$isBound</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bound</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
		<span class=c1>//删除已经注册过的别名
</span><span class=c1></span>    <span class=nx>unset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>aliases</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]);</span>

		<span class=c1>//核心 把实例直接保存在instances数组中
</span><span class=c1></span>		<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$instance</span><span class=p>;</span>

    <span class=k>if</span> <span class=p>(</span><span class=nv>$isBound</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>rebound</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=nv>$instance</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>我们发现如果绑定的是一个实例, 会直接把这个实例放在实例数组中, 使用的时候可以直接取到.</p><h3 id=绑定接口至实现>绑定接口至实现</h3><p>服务容器的一个非常强大的特性是它能够将接口绑定到给定的实现。例如，假设我们有一个 <code>EventPusher</code> 接口和一个 <code>RedisEventPusher</code> 实现。一旦我们对这个接口的 <code>RedisEventPusher</code> 实现进行了编码，我们就可以像这样在服务容器中注册它：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Contracts\EventPusher</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Services\RedisEventPusher</span><span class=p>;</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>bind</span><span class=p>(</span><span class=nx>EventPusher</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nx>RedisEventPusher</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><p>此语句告诉容器，当类需要 <code>EventPusher</code> 的实现时，它应该注入 <code>RedisEventPusher</code>。现在我们可以在容器解析的类的构造函数中加上 <code>EventPusher</code> 接口作为类型提示。请记住，控制器、事件侦听器、中间件和 Laravel 应用程序中的各种其他的类始终使用容器进行解析：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Contracts\EventPusher</span><span class=p>;</span>

<span class=sd>/**
</span><span class=sd> * 创建一个新的实例
</span><span class=sd> *
</span><span class=sd> * @param  \App\Contracts\EventPusher  $pusher
</span><span class=sd> * @return void
</span><span class=sd> */</span>
<span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>EventPusher</span> <span class=nv>$pusher</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>pusher</span> <span class=o>=</span> <span class=nv>$pusher</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>在前文中我们提到, 如果绑定的是一个实现类, 不是闭包, 那么会把实现类转换成闭包, 然后再放进bindings数组中保存.</p><p>我们看下获取一个实现类的闭包是怎么实现的:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>protected</span> <span class=k>function</span> <span class=nf>getClosure</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$concrete</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>return</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$container</span><span class=p>,</span> <span class=nv>$parameters</span> <span class=o>=</span> <span class=p>[])</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$concrete</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=nv>$abstract</span> <span class=o>==</span> <span class=nv>$concrete</span><span class=p>)</span> <span class=p>{</span>
						<span class=c1>//如果抽象和实现类相同, 那么调用build方法
</span><span class=c1></span>            <span class=k>return</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>build</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>);</span>
        <span class=p>}</span>
				<span class=c1>//如果抽象和实现类不同, 那么调用resolve方法
</span><span class=c1></span>        <span class=k>return</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>resolve</span><span class=p>(</span>
            <span class=nv>$concrete</span><span class=p>,</span> <span class=nv>$parameters</span><span class=p>,</span> <span class=nv>$raiseEvents</span> <span class=o>=</span> <span class=k>false</span>
        <span class=p>);</span>
    <span class=p>};</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>build方法和resolve方法都是创建实例相关的代码, 我们后面在讲解析make()方法的时候会着重讲解这两个方法. 在这里你知道要知道, 如果穿进来的是一个实现类, 那么在保存关系的时候会把实现类转换成创建实现类实例的闭包. 这样bindings中的抽象和实现的关联关系就统一了起来, 都是抽象类型对应实现类的闭包.</p><h3 id=上下文绑定>上下文绑定</h3><blockquote><p>译者注：所谓「上下文绑定」就是根据上下文进行动态的绑定。</p></blockquote><p>有时你可能有两个类使用相同的接口，但是你希望将不同的实现分别注入到各自的类中。例如，两个控制器可能依赖于 <code>Illuminate\Contracts\Filesystem\Filesystem</code> <a href=https://learnku.com/docs/laravel/8.x/contracts target=_blank rel="noopener noreffer">契约</a> 的不同实现。Laravel 提供了一个简单流畅的方式来定义这种行为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Http\Controllers\PhotoController</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Http\Controllers\UploadController</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Http\Controllers\VideoController</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Contracts\Filesystem\Filesystem</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Storage</span><span class=p>;</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nx>PhotoController</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=nx>Filesystem</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>give</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
              <span class=k>return</span> <span class=nx>Storage</span><span class=o>::</span><span class=na>disk</span><span class=p>(</span><span class=s1>&#39;local&#39;</span><span class=p>);</span>
          <span class=p>});</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>([</span><span class=nx>VideoController</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nx>UploadController</span><span class=o>::</span><span class=na>class</span><span class=p>])</span>
          <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=nx>Filesystem</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>give</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
              <span class=k>return</span> <span class=nx>Storage</span><span class=o>::</span><span class=na>disk</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>);</span>
          <span class=p>});</span>
</code></pre></td></tr></table></div></div><p>有了上下文关系之后, 我们就可以先设置上下文的信息, 然后容器反射创建类的实例的时候, 就可以根据上下文信息, 对构造方法进行传参.</p><p>我们可以看下代码:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>when</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$aliases</span> <span class=o>=</span> <span class=p>[];</span>
		<span class=c1>//如果传进来$concrete是个数组, 这个地方也是可以兼容的
</span><span class=c1></span>    <span class=k>foreach</span> <span class=p>(</span><span class=nx>Util</span><span class=o>::</span><span class=na>arrayWrap</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>)</span> <span class=k>as</span> <span class=nv>$c</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$aliases</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getAlias</span><span class=p>(</span><span class=nv>$c</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=k>new</span> <span class=nx>ContextualBindingBuilder</span><span class=p>(</span><span class=nv>$this</span><span class=p>,</span> <span class=nv>$aliases</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>调用when方法的时候返回了一个<code>\Illuminate\Container\ContextualBindingBuilder</code>实例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>needs</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>needs</span> <span class=o>=</span> <span class=nv>$abstract</span><span class=p>;</span>

    <span class=k>return</span> <span class=nv>$this</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>needs设置了需要的抽象是什么</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>give</span><span class=p>(</span><span class=nv>$implementation</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>foreach</span> <span class=p>(</span><span class=nx>Util</span><span class=o>::</span><span class=na>arrayWrap</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>concrete</span><span class=p>)</span> <span class=k>as</span> <span class=nv>$concrete</span><span class=p>)</span> <span class=p>{</span>
				<span class=c1>//保存上下文绑定信息
</span><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>container</span><span class=o>-&gt;</span><span class=na>addContextualBinding</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>needs</span><span class=p>,</span> <span class=nv>$implementation</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>我们依次给容器添加了上下文绑定</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>addContextualBinding</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>,</span> <span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$implementation</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>contextual</span><span class=p>[</span><span class=nv>$concrete</span><span class=p>][</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getAlias</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>)]</span> <span class=o>=</span> <span class=nv>$implementation</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>由此可知绑定信息是方放在容器的contextual数组里面, 通过这个数组, 我们在实例化的时候, 可以轻松找到构造方法对应的参数应该怎么传.</p><h3 id=绑定基本值>绑定基本值</h3><p>有时您可能有一个类接收一些注入的类，但也需要一个注入的原语值，如整数。您可以轻松地使用上下文绑定来注入类可能需要的任何值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=s1>&#39;App\Http\Controllers\UserController&#39;</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=s1>&#39;$variableName&#39;</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>give</span><span class=p>(</span><span class=nv>$value</span><span class=p>);</span>

</code></pre></td></tr></table></div></div><p>有时类可能依赖于 <a href=about:blank#tagging rel>标记</a> 实例数组。使用 <code>givetaged</code> 方法，可以轻松地将所有容器绑定插入该标记中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nx>ReportAggregator</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
    <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=s1>&#39;$reports&#39;</span><span class=p>)</span>
    <span class=o>-&gt;</span><span class=na>giveTagged</span><span class=p>(</span><span class=s1>&#39;reports&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>giveTagged</span><span class=p>(</span><span class=nv>$tag</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//调用give方法, 传入了闭包, 这个闭包的作用是使用标签来获取被打标的对应的所有抽象类型
</span><span class=c1></span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>give</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$container</span><span class=p>)</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$tag</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$taggedServices</span> <span class=o>=</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>tagged</span><span class=p>(</span><span class=nv>$tag</span><span class=p>);</span>

        <span class=k>return</span> <span class=nx>is_array</span><span class=p>(</span><span class=nv>$taggedServices</span><span class=p>)</span> <span class=o>?</span> <span class=nv>$taggedServices</span> <span class=o>:</span><span class=nx>iterator_to_array</span><span class=p>(</span><span class=nv>$taggedServices</span><span class=p>);</span>
    <span class=p>});</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>give方法前面已经讲解过了, 依次保存上下文信息到服务容器中去.</p><p>如果需要从应用程序的某个配置文件中插入值，可以使用 <code>giveConfig</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nx>ReportAggregator</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
    <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=s1>&#39;$timezone&#39;</span><span class=p>)</span>
    <span class=o>-&gt;</span><span class=na>giveConfig</span><span class=p>(</span><span class=s1>&#39;app.timezone&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>giveConfig</span><span class=p>(</span><span class=nv>$key</span><span class=p>,</span> <span class=nv>$default</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//传入了闭包, 这个闭包的作用是使用$key和$default来获取系统的
</span><span class=c1></span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>give</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$container</span><span class=p>)</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$key</span><span class=p>,</span> <span class=nv>$default</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;config&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=nv>$key</span><span class=p>,</span> <span class=nv>$default</span><span class=p>);</span>
    <span class=p>});</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>如果</p><h3 id=绑定变长参数类型>绑定变长参数类型</h3><p>有时，您可能会有一个类，它的构造函数使用可变参数接收指定类型的对象的数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>use</span> <span class=nx>App\Models\Filter</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Services\Logger</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>Firewall</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * 日志实例
</span><span class=sd>     *
</span><span class=sd>     * @var \App\Services\Logger
</span><span class=sd>     */</span>
    <span class=k>protected</span> <span class=nv>$logger</span><span class=p>;</span>

    <span class=sd>/**
</span><span class=sd>     * 过滤器实例数组
</span><span class=sd>     *
</span><span class=sd>     * @var array
</span><span class=sd>     */</span>
    <span class=k>protected</span> <span class=nv>$filters</span><span class=p>;</span>

    <span class=sd>/**
</span><span class=sd>     * 创建一个类实例
</span><span class=sd>     *
</span><span class=sd>     * @param  \App\Services\Logger  $logger
</span><span class=sd>     * @param  array  $filters
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>Logger</span> <span class=nv>$logger</span><span class=p>,</span> <span class=nx>Filter</span> <span class=o>...</span><span class=nv>$filters</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>logger</span> <span class=o>=</span> <span class=nv>$logger</span><span class=p>;</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filters</span> <span class=o>=</span> <span class=nv>$filters</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></td></tr></table></div></div><p>使用上下文绑定，可以通过为 <code>give</code> 方法提供一个闭包来解析此依赖关系，该闭包返回已解析的 <code>Filter</code> 实例数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nx>Firewall</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=nx>Filter</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>give</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=p>[</span>
                    <span class=nv>$app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>NullFilter</span><span class=o>::</span><span class=na>class</span><span class=p>),</span>
                    <span class=nv>$app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>ProfanityFilter</span><span class=o>::</span><span class=na>class</span><span class=p>),</span>
                    <span class=nv>$app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>TooLongFilter</span><span class=o>::</span><span class=na>class</span><span class=p>),</span>
                <span class=p>];</span>
          <span class=p>});</span>
</code></pre></td></tr></table></div></div><p>为了方便起见，您还可以只提供一个类名数组，以便在 <code>Firewall</code> 需要 <code>Filter</code> 实例时由容器解析：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nx>Firewall</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=nx>Filter</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
          <span class=o>-&gt;</span><span class=na>give</span><span class=p>([</span>
              <span class=nx>NullFilter</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
              <span class=nx>ProfanityFilter</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
              <span class=nx>TooLongFilter</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
          <span class=p>]);</span>
</code></pre></td></tr></table></div></div><blockquote><p>译者注：后一种方法可以在用到这些过滤器的时候，才实例化它，而不是在 Firwall 类实例化的时候，就实例化所有的过滤器。</p></blockquote><h3 id=变长参数的关联标签>变长参数的关联标签</h3><p>有时一个类可能有变长参数的依赖关系，它的类型提示是给定的类（ <code>Report</code> ）。使用 <code>needs</code> 和 <code>givetaged</code> 方法，您可以轻松地为给定的依赖项注入所有具有该 <a href=about:blank#tagging rel>tag</a> 的容器绑定：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nx>ReportAggregator</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
    <span class=o>-&gt;</span><span class=na>needs</span><span class=p>(</span><span class=nx>Report</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
    <span class=o>-&gt;</span><span class=na>giveTagged</span><span class=p>(</span><span class=s1>&#39;reports&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><blockquote><p>译者注：最后一句比较绕，可以这样理解：你可以把这些类组织到一个 标签 中，这样你就可以轻松地为特定的依赖项打包一起注入到容器中。</p></blockquote><h3 id=标签>标签</h3><p>有时，您可能需要解析绑定的所有特定 「分类」 的类。例如，您可能正在构建一个报表分析器，它接收许多不同的 <code>report</code> 接口实现的数组。注册 <code>Report</code> 实例后，可以使用 <code>tag</code> 方法为它们分配一个统一的标记：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>bind</span><span class=p>(</span><span class=nx>CpuReport</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=c1>//
</span><span class=c1></span><span class=p>});</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>bind</span><span class=p>(</span><span class=nx>MemoryReport</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=c1>//
</span><span class=c1></span><span class=p>});</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>tag</span><span class=p>([</span><span class=nx>CpuReport</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nx>MemoryReport</span><span class=o>::</span><span class=na>class</span><span class=p>],</span> <span class=s1>&#39;reports&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>tag</span><span class=p>(</span><span class=nv>$abstracts</span><span class=p>,</span> <span class=nv>$tags</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//$tags既可以是一个tag数组, 也可以是tag字符串, laravel框架有很多种这样的写法, 来兼容输入的类型
</span><span class=c1></span>    <span class=nv>$tags</span> <span class=o>=</span><span class=nx>is_array</span><span class=p>(</span><span class=nv>$tags</span><span class=p>)</span> <span class=o>?</span> <span class=nv>$tags</span> <span class=o>:</span><span class=nx>array_slice</span><span class=p>(</span><span class=nx>func_get_args</span><span class=p>(),</span> <span class=mi>1</span><span class=p>);</span>

    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$tags</span> <span class=k>as</span> <span class=nv>$tag</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>tags</span><span class=p>[</span><span class=nv>$tag</span><span class=p>]))</span> <span class=p>{</span>
            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>tags</span><span class=p>[</span><span class=nv>$tag</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
        <span class=p>}</span>

        <span class=k>foreach</span> <span class=p>((</span><span class=k>array</span><span class=p>)</span> <span class=nv>$abstracts</span> <span class=k>as</span> <span class=nv>$abstract</span><span class=p>)</span> <span class=p>{</span>
            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>tags</span><span class=p>[</span><span class=nv>$tag</span><span class=p>][]</span> <span class=o>=</span> <span class=nv>$abstract</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>tag方法代码很简单, 就是使用tags数组去保存tag对应的抽象类型.</p><p>一旦服务被打上标签，你就可以通过容器的 <code>tagged</code> 方法轻松地解析它们：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>bind</span><span class=p>(</span><span class=nx>ReportAnalyzer</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=nx>ReportAnalyzer</span><span class=p>(</span><span class=nv>$app</span><span class=o>-&gt;</span><span class=na>tagged</span><span class=p>(</span><span class=s1>&#39;reports&#39;</span><span class=p>));</span>
<span class=p>});</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>tagged</span><span class=p>(</span><span class=nv>$tag</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>tags</span><span class=p>[</span><span class=nv>$tag</span><span class=p>]))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=p>[];</span>
    <span class=p>}</span>
		<span class=c1>//返回了一个迭代器, 我们可以直接foreach tagged($tag)的结果 每个元素是tag对应抽象类型的实例
</span><span class=c1></span>    <span class=k>return</span> <span class=k>new</span> <span class=nx>RewindableGenerator</span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$tag</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>tags</span><span class=p>[</span><span class=nv>$tag</span><span class=p>]</span> <span class=k>as</span> <span class=nv>$abstract</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>yield</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span><span class=nx>count</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>tags</span><span class=p>[</span><span class=nv>$tag</span><span class=p>]));</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><h3 id=继承绑定>继承绑定</h3><p><code>extend</code> 方法允许修改已解析的服务。例如，解析服务时，可以运行其他代码来修饰或配置服务。 <code>extend</code> 方法接受闭包，该闭包应返回修改后的服务作为其唯一参数。闭包接收正在解析的服务和容器实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>extend</span><span class=p>(</span><span class=nx>Service</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$service</span><span class=p>,</span> <span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=nx>DecoratedService</span><span class=p>(</span><span class=nv>$service</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>extend</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$closure</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$abstract</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getAlias</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
		
    <span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]))</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$closure</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>],</span> <span class=nv>$this</span><span class=p>);</span>

        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>rebound</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>extenders</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>][]</span> <span class=o>=</span> <span class=nv>$closure</span><span class=p>;</span>

        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolved</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>))</span> <span class=p>{</span>
            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>rebound</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>extend可以对已经解析的实例进行扩展, 使用闭包实现. 如果没有解析的实例, 会放在容器的extenders数组中进行保存, 到时候解析的时候, 可以直接扩展.</p><blockquote><p>译者注：类似于类的继承</p></blockquote><h2 id=解析>解析</h2><h3 id=make-方法><code>make</code> 方法</h3><p>可以使用 <code>make</code> 方法从容器中解析类实例。 <code>make</code> 方法接受要解析的类或接口的名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>

<span class=nv>$transistor</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>make</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=k>array</span> <span class=nv>$parameters</span> <span class=o>=</span> <span class=p>[])</span>
<span class=p>{</span>
    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolve</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$parameters</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>protected</span> <span class=k>function</span> <span class=nf>resolve</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$parameters</span> <span class=o>=</span> <span class=p>[],</span> <span class=nv>$raiseEvents</span> <span class=o>=</span> <span class=k>true</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//获取抽象的别名
</span><span class=c1></span>    <span class=nv>$abstract</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getAlias</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>

		<span class=k>if</span> <span class=p>(</span><span class=nv>$raiseEvents</span><span class=p>)</span> <span class=p>{</span>
				<span class=c1>//调用解析之前回调
</span><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>fireBeforeResolvingCallbacks</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$parameters</span><span class=p>);</span>
    <span class=p>}</span>

		<span class=c1>//获取上下文绑定的实现
</span><span class=c1></span>    <span class=nv>$concrete</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getContextualConcrete</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>

    <span class=nv>$needsContextualBuild</span> <span class=o>=</span> <span class=o>!</span> <span class=k>empty</span><span class=p>(</span><span class=nv>$parameters</span><span class=p>)</span> <span class=o>||</span> <span class=o>!</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>);</span>

		<span class=c1>//如果有单例且不需要参数构造 直接返回
</span><span class=c1></span>		<span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span> <span class=nv>$needsContextualBuild</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>];</span>
    <span class=p>}</span>

    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$parameters</span><span class=p>;</span>

		<span class=c1>//上下文没有定义实现的时候 要找绑定的实现
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>))</span> <span class=p>{</span>
        <span class=nv>$concrete</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getConcrete</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=p>}</span>
		
		<span class=c1>//可以构造的条件是: $concrete === $abstract || $concrete instanceof Closure
</span><span class=c1></span>		<span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>isBuildable</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>,</span> <span class=nv>$abstract</span><span class=p>))</span> <span class=p>{</span>
				<span class=o>**//</span><span class=nx>方法的核心build</span><span class=o>**</span>
        <span class=nv>$object</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>build</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
				<span class=c1>//不能构造就创建实现类
</span><span class=c1></span>        <span class=nv>$object</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>);</span>
    <span class=p>}</span>

		<span class=c1>//如果对实例有扩展回调的话, 也要依次调用一下
</span><span class=c1></span>		<span class=k>foreach</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getExtenders</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>)</span> <span class=k>as</span> <span class=nv>$extender</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$object</span> <span class=o>=</span> <span class=nv>$extender</span><span class=p>(</span><span class=nv>$object</span><span class=p>,</span> <span class=nv>$this</span><span class=p>);</span>
    <span class=p>}</span>
		
		<span class=c1>//如果是分享的实例, 要放在instances中保存
</span><span class=c1></span>		<span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>isShared</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span> <span class=nv>$needsContextualBuild</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>instances</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$object</span><span class=p>;</span>
    <span class=p>}</span>
		
    <span class=k>if</span> <span class=p>(</span><span class=nv>$raiseEvents</span><span class=p>)</span> <span class=p>{</span>
				<span class=c1>//解析后回调
</span><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>fireResolvingCallbacks</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$object</span><span class=p>);</span>
    <span class=p>}</span>
		
		<span class=c1>//所有解析过的抽象要标记
</span><span class=c1></span>		<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolved</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>]</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>

		<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>);</span>

    <span class=k>return</span> <span class=nv>$object</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>build</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//如果实现是闭包, 那么直接调用闭包方法就创建了实例了
</span><span class=c1></span>		<span class=k>if</span> <span class=p>(</span><span class=nv>$concrete</span> <span class=nx>instanceof</span> <span class=nx>Closure</span><span class=p>)</span> <span class=p>{</span>
				<span class=c1>//这个闭包有两个参数, 第一个参数是服务容器, 所有自定义闭包的时候一定要传容器
</span><span class=c1></span>        <span class=k>return</span> <span class=nv>$concrete</span><span class=p>(</span><span class=nv>$this</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getLastParameterOverride</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=k>try</span> <span class=p>{</span>
				<span class=c1>//通过反射获取反射类实例
</span><span class=c1></span>        <span class=nv>$reflector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ReflectionClass</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>ReflectionException</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=nx>BindingResolutionException</span><span class=p>(</span><span class=s2>&#34;Target class [</span><span class=si>$concrete</span><span class=s2>] does not exist.&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nv>$e</span><span class=p>);</span>
    <span class=p>}</span>

		<span class=c1>//如果构造方法是private的, 直接抛异常
</span><span class=c1></span>		<span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nv>$reflector</span><span class=o>-&gt;</span><span class=na>isInstantiable</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>notInstantiable</span><span class=p>(</span><span class=nv>$concrete</span><span class=p>);</span>
    <span class=p>}</span>

		<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>buildStack</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$concrete</span><span class=p>;</span>
		<span class=c1>//获取到了反射的构造方法
</span><span class=c1></span>    <span class=nv>$constructor</span> <span class=o>=</span> <span class=nv>$reflector</span><span class=o>-&gt;</span><span class=na>getConstructor</span><span class=p>();</span>
		<span class=c1>//如果没有构造方法, 直接就new一个实例
</span><span class=c1></span>		<span class=k>if</span> <span class=p>(</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$constructor</span><span class=p>))</span> <span class=p>{</span>
				<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>buildStack</span><span class=p>);</span>

        <span class=k>return</span> <span class=k>new</span> <span class=nv>$concrete</span><span class=p>;</span>
    <span class=p>}</span>
		
		<span class=c1>//获取构造方法的依赖
</span><span class=c1></span>    <span class=nv>$dependencies</span> <span class=o>=</span> <span class=nv>$constructor</span><span class=o>-&gt;</span><span class=na>getParameters</span><span class=p>();</span>

		<span class=k>try</span> <span class=p>{</span>
				<span class=c1>//获取构造方法的实例
</span><span class=c1></span>        <span class=nv>$instances</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolveDependencies</span><span class=p>(</span><span class=nv>$dependencies</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>BindingResolutionException</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
				<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>buildStack</span><span class=p>);</span>

        <span class=k>throw</span> <span class=nv>$e</span><span class=p>;</span>
    <span class=p>}</span>

		<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>buildStack</span><span class=p>);</span>
		<span class=c1>//传参构造方法创建实例
</span><span class=c1></span>    <span class=k>return</span> <span class=nv>$reflector</span><span class=o>-&gt;</span><span class=na>newInstanceArgs</span><span class=p>(</span><span class=nv>$instances</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>protected</span> <span class=k>function</span> <span class=nf>resolveDependencies</span><span class=p>(</span><span class=k>array</span> <span class=nv>$dependencies</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$results</span> <span class=o>=</span> <span class=p>[];</span>

    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$dependencies</span> <span class=k>as</span> <span class=nv>$dependency</span><span class=p>)</span> <span class=p>{</span>
				<span class=c1>//如果参数覆盖了, 使用覆盖后的参数
</span><span class=c1></span>				<span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>hasParameterOverride</span><span class=p>(</span><span class=nv>$dependency</span><span class=p>))</span> <span class=p>{</span>
            <span class=nv>$results</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getParameterOverride</span><span class=p>(</span><span class=nv>$dependency</span><span class=p>);</span>
            <span class=k>continue</span><span class=p>;</span>
        <span class=p>}</span>
				
				<span class=c1>//如果参数的声明是某个类型 实例化类 如果是基本类型 就去上下文找
</span><span class=c1></span>				<span class=nv>$result</span> <span class=o>=</span><span class=nx>is_null</span><span class=p>(</span><span class=nx>Util</span><span class=o>::</span><span class=na>getParameterClassName</span><span class=p>(</span><span class=nv>$dependency</span><span class=p>))</span>
												<span class=c1>//解析基本类型
</span><span class=c1></span>                        <span class=o>?</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolvePrimitive</span><span class=p>(</span><span class=nv>$dependency</span><span class=p>)</span>
												<span class=c1>//解析类
</span><span class=c1></span>                        <span class=o>:</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolveClass</span><span class=p>(</span><span class=nv>$dependency</span><span class=p>);</span>

        <span class=k>if</span> <span class=p>(</span><span class=nv>$dependency</span><span class=o>-&gt;</span><span class=na>isVariadic</span><span class=p>())</span> <span class=p>{</span>
            <span class=nv>$results</span> <span class=o>=</span><span class=nx>array_merge</span><span class=p>(</span><span class=nv>$results</span><span class=p>,</span> <span class=nv>$result</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=nv>$results</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$result</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=nv>$results</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>protected</span> <span class=k>function</span> <span class=nf>resolvePrimitive</span><span class=p>(</span><span class=nx>ReflectionParameter</span> <span class=nv>$parameter</span><span class=p>)</span>
<span class=p>{</span>
		<span class=c1>//上下文如果定义的话, 直接从上下文获取
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$concrete</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getContextualConcrete</span><span class=p>(</span><span class=s1>&#39;$&#39;</span><span class=o>.</span><span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>getName</span><span class=p>())))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$concrete</span> <span class=nx>instanceof</span> <span class=nx>Closure</span> <span class=o>?</span> <span class=nv>$concrete</span><span class=p>(</span><span class=nv>$this</span><span class=p>)</span> <span class=o>:</span> <span class=nv>$concrete</span><span class=p>;</span>
    <span class=p>}</span>
		<span class=c1>//没有定义看有没有默认值
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>isDefaultValueAvailable</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>getDefaultValue</span><span class=p>();</span>
    <span class=p>}</span>
		
		<span class=c1>//除此之外要抛出异常
</span><span class=c1></span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>unresolvablePrimitive</span><span class=p>(</span><span class=nv>$parameter</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>protected</span> <span class=k>function</span> <span class=nf>resolveClass</span><span class=p>(</span><span class=nx>ReflectionParameter</span> <span class=nv>$parameter</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>try</span> <span class=p>{</span>
				<span class=c1>//判断是否是可变参数
</span><span class=c1></span>        <span class=k>return</span> <span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>isVariadic</span><span class=p>()</span>
										<span class=c1>//如果是可变参数
</span><span class=c1></span>                    <span class=o>?</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolveVariadicClass</span><span class=p>(</span><span class=nv>$parameter</span><span class=p>)</span>
										<span class=c1>//如果不是可变参数可以直接创建参数对应的实例 getParameterClassName是获取参数的类名
</span><span class=c1></span>                    <span class=o>:</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nx>Util</span><span class=o>::</span><span class=na>getParameterClassName</span><span class=p>(</span><span class=nv>$parameter</span><span class=p>));</span>
    <span class=p>}</span>

		<span class=k>catch</span> <span class=p>(</span><span class=nx>BindingResolutionException</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>isDefaultValueAvailable</span><span class=p>())</span> <span class=p>{</span>
						<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>);</span>

            <span class=k>return</span> <span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>getDefaultValue</span><span class=p>();</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=nv>$parameter</span><span class=o>-&gt;</span><span class=na>isVariadic</span><span class=p>())</span> <span class=p>{</span>
						<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>);</span>

            <span class=k>return</span> <span class=p>[];</span>
        <span class=p>}</span>

        <span class=k>throw</span> <span class=nv>$e</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>protected</span> <span class=k>function</span> <span class=nf>resolveVariadicClass</span><span class=p>(</span><span class=nx>ReflectionParameter</span> <span class=nv>$parameter</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$className</span> <span class=o>=</span> <span class=nx>Util</span><span class=o>::</span><span class=na>getParameterClassName</span><span class=p>(</span><span class=nv>$parameter</span><span class=p>);</span>

    <span class=nv>$abstract</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getAlias</span><span class=p>(</span><span class=nv>$className</span><span class=p>);</span>

    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_array</span><span class=p>(</span><span class=nv>$concrete</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getContextualConcrete</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>)))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nv>$className</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>returnarray_map</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$abstract</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolve</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=p>},</span> <span class=nv>$concrete</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>如果类的某些依赖项不能通过容器进行解析，可以通过将它们作为关联数组传递到 <code>makeWith</code> 方法来注入它们。例如，我们可以手动传递 <code>Transistor</code> 服务所需的 <code>$id</code> 构造函数参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>

<span class=nv>$transistor</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>makeWith</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>]);</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>makeWith</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=k>array</span> <span class=nv>$parameters</span> <span class=o>=</span> <span class=p>[])</span>
<span class=p>{</span>
    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>make</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nv>$parameters</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>makeWith其实是make方法的别名, 只不过用makeWith更符合语义: 带参数的make. make方法在前面已经讲解, 这里就不再重复了.</p><p>如果你在服务提供商之外的代码位置无法访问 <code>$app</code> 变量，则可以使用 <code>App</code> <a href=https://learnku.com/docs/laravel/8.x/facades target=_blank rel="noopener noreffer">facade</a> 从容器解析类实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\App</span><span class=p>;</span>

<span class=nv>$transistor</span> <span class=o>=</span> <span class=nx>App</span><span class=o>::</span><span class=na>make</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><p>如果希望将 Laravel 容器实例本身注入到由容器解析的类中，可以在你的类的构造函数中添加 <code>Illuminate\container\container</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>Illuminate\Container\Container</span><span class=p>;</span>

<span class=sd>/**
</span><span class=sd> * 实例化一个类
</span><span class=sd> *
</span><span class=sd> * @param  \Illuminate\Container\Container
</span><span class=sd> * @return void
</span><span class=sd> */</span>
<span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>Container</span> <span class=nv>$container</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>container</span> <span class=o>=</span> <span class=nv>$container</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><h3 id=自动注入>自动注入</h3><p>另外，并且更重要的是，你可以简单地使用「类型提示」的方式在类的构造函数中注入那些需要容器解析的依赖项，包括 <a href=https://learnku.com/docs/laravel/8.x/controllers target=_blank rel="noopener noreffer">控制器</a>，<a href=https://learnku.com/docs/laravel/8.x/events target=_blank rel="noopener noreffer">事件</a>，<a href=https://learnku.com/docs/laravel/8.x/middleware target=_blank rel="noopener noreffer">中间件</a> 等 。此外，你也可以在 <a href=https://learnku.com/docs/laravel/8.x/queues target=_blank rel="noopener noreffer">队列任务</a> 的 <code>handle</code> 方法中使用「类型提示」注入依赖。实际上，这才是大多数对象应该被容器解析的方式。</p><p>例如，你可以在控制器的构造函数中添加一个 repository 的类型提示，然后这个 repository 将会被自动解析并注入类中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>namespace</span> <span class=nx>App\Http\Controllers</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>App\Repositories\UserRepository</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * user 仓储实例
</span><span class=sd>     *
</span><span class=sd>     * @var \App\Repositories\UserRepository
</span><span class=sd>     */</span>
    <span class=k>protected</span> <span class=nv>$users</span><span class=p>;</span>

    <span class=sd>/**
</span><span class=sd>     * 创建一个控制器实例
</span><span class=sd>     *
</span><span class=sd>     * @param  \App\Repositories\UserRepository  $users
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>UserRepository</span> <span class=nv>$users</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>users</span> <span class=o>=</span> <span class=nv>$users</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=sd>/**
</span><span class=sd>     * 使用给定的 id 显示 user
</span><span class=sd>     *
</span><span class=sd>     * @param  int  $id
</span><span class=sd>     * @return \Illuminate\Http\Response
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nv>$id</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=c1>//
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><h2 id=容器事件>容器事件</h2><p>服务容器每次解析对象会触发一个事件，你可以使用 <code>resolving</code> 方法监听这个事件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>resolving</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$transistor</span><span class=p>,</span> <span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 当容器解析类型为 &#34;Transistor&#34; 的对象时调用...
</span><span class=c1></span><span class=p>});</span>

<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>resolving</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$object</span><span class=p>,</span> <span class=nv>$app</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 当容器解析任何类型的对象时调用
</span><span class=c1></span><span class=p>});</span>
</code></pre></td></tr></table></div></div><p>如你所见，正在解析的对象将被传递给回调，从而允许你在将对象提供给其使用者之前设置该对象的任何附加属性。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>resolving</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>,</span> <span class=nx>Closure</span> <span class=nv>$callback</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>is_string</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>))</span> <span class=p>{</span>
        <span class=nv>$abstract</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getAlias</span><span class=p>(</span><span class=nv>$abstract</span><span class=p>);</span>
    <span class=p>}</span>
		<span class=c1>//如果只传了$abstract恰巧$abstract还是一个闭包 就注册一个全局的解析回调
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$callback</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$abstract</span> <span class=nx>instanceof</span> <span class=nx>Closure</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>globalResolvingCallbacks</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$abstract</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
				<span class=c1>//否则就注册一个抽象类型的回调
</span><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>resolvingCallbacks</span><span class=p>[</span><span class=nv>$abstract</span><span class=p>][]</span> <span class=o>=</span> <span class=nv>$callback</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>这个方法其实是有歧义的, 我不建议这样写代码, 这样会给阅读源码的人带来困惑, 违反了单一指责原则. 一个方法实际上实现了两个功能, 一个是注册全局回调, 一个是注册了解析了某个抽象的回调. 当然原理是简单的, 还是用数组保存抽象对应的回调就可以了.</p><h2 id=psr-11>PSR-11</h2><p>Laravel 的容器服务实现了 <a href=https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-11-container.md target=_blank rel="noopener noreffer">PSR-11</a> 接口。 因此，您可以在 PSR-11 容器接口的类型提示中获取 Laravel 容器的实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Transistor</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Psr\Container\ContainerInterface</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>ContainerInterface</span> <span class=nv>$container</span><span class=p>)</span> <span class=p>{</span>
    <span class=nv>$service</span> <span class=o>=</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=nx>Transistor</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>

    <span class=c1>//
</span><span class=c1></span><span class=p>});</span>

</code></pre></td></tr></table></div></div><p>如果给定的标识符无法解析，将引发异常。如果标识符从未绑定，则异常将是 <code>Psr\Container\NotFoundExceptionInterface</code> 的实例。如果标识符已绑定但无法解析，则将抛出 <code>Psr\Container\ContainerExceptionInterface</code> 的实例。</p><blockquote><p>本译文仅用于学习和交流目的，转载请务必注明文章译者、出处、和本文链接
我们的翻译工作遵照 CC 协议，如果我们的工作有侵犯到您的权益，请及时联系我们。</p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-09-27&nbsp;<a class=git-hash href=https://github.com/v2wy/commit/458e0aaaafec893c22e2f26f59f7ac8bad925a22 target=_blank title="commit by morty.wang(790538318@qq.com) 458e0aaaafec893c22e2f26f59f7ac8bad925a22: Update demo.md">
<i class="fas fa-hashtag fa-fw"></i>458e0aa</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/demo/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://v2wy.com/demo/ data-title=服务容器><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://v2wy.com/demo/><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://v2wy.com/demo/ data-title=服务容器><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://v2wy.com/demo/ data-title=服务容器><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://v2wy.com/demo/ data-title=服务容器><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/emoji-support/ class=next rel=next title="Emoji 支持">Emoji 支持<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.81.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Morty</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://disqus_loa2yGoW6u.disqus.com/embed.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:20},comment:{},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.zh-cn",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>